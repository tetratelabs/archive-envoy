# `name` value will appear "as is" in the badge.
# See https://docs.github.com/en/actions/configuring-and-managing-workflows/configuring-a-workflow#adding-a-workflow-status-badge-to-your-repository
# yamllint --format github .github/workflows/release.yaml
---
name: "release"

on:
  push:
    tags: 'v[0-9]+.[0-9]+.[0-9]+**'  # Ex. v1.18.3

jobs:
  archive:
    name: Archive EnvoyÂ® Release
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Get the release tag name
        run: echo "TAG=${GITHUB_REF/refs\/tags\//}" >> $GITHUB_ENV
      - name: Archive Envoy Release
        run: ./bin/archive_release_version.sh envoyproxy/envoy ${{ env.TAG }}
      - name: Upload GitHub Release
        uses: ncipollo/release-action@v1
        with:
          artifacts: "${{ env.TAG }}/*"
          allowUpdates: true
          token: ${{ secrets.GITHUB_TOKEN }}
